<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<link rel="stylesheet" type="text/css" href="/styles.css">

		<script>
		MathJax = {
			loader: {
				load: [
				'input/tex-base', '[tex]/newcommand', '[tex]/action',
				'output/chtml'
				]
			},
			tex: {
				inlineMath: [['\\(', '\\)']],
				packages: ['base', 'newcommand', 'action']
			}
		};
		</script>

		<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
		<title></title>
	</head>

	<body>
		<div class="sidebar">
			<h3> <a href="/index.html">Home</a> </h3>
			
				<h3> Tope </h3>
				
					<li><a href="/mabs/tope/howto.html">
						HOWTO
					</a><br></li>
				
					<li><a href="/mabs/tope/documentation.html">
						Documentation
					</a><br></li>
				
					<li><a href="/mabs/tope/rapport.html"style="color: red;">
						Rapport
					</a><br></li>
				
			
				<h3> Cross </h3>
				
					<li><a href="/mabs/cross/howto.html">
						HOWTO
					</a><br></li>
				
					<li><a href="/mabs/cross/documentation.html">
						Documentation
					</a><br></li>
				
					<li><a href="/mabs/cross/rapport.html">
						Rapport
					</a><br></li>
				
			
		</div>

		<div class="main">
			<p class="title">MAbTope</p>

<p>Pour l’histoire, le programme a été fait en deux fois. Au début il y a avait la partie <em>params</em>, puis la partie <em>scripts</em> s’est ajouté et a intégrer <em>params</em>.</p>

<h1 id="params">Params</h1>
<p>Corrections et changements.</p>

<ul>
  <li>Le changement de résidu se faisait lorsqu’on trouvait un atome <em>N</em>, ce qui est simplement faux sur certains fichiers.
  Le changement se fait maintenant en vérifiant qu’au moins l’un de ces deux attributs a changé :
    <ul>
      <li>l’identifiant de chaîne,</li>
      <li>le numéro de séquence ou (inclusif) le code d’insertion du résidu.</li>
    </ul>
  </li>
  <li>
    <p>L’ordre des conditions sur le changement de résidus faisait qu’on incluait le premier <em>N</em> dans le calcul
  des centres de gravité des résidus, alors qu’on ne devait pas. J’ai corrigé.</p>
  </li>
  <li>La manière de reconnaître les atomes d’hydrogène a changé.
    <ul>
      <li>Avant : <em>name[1]==’H’</em> et <em>name[2]!=’G’</em>.</li>
      <li>Maintenant : premier caractère non vide et non numérique est <em>H</em> et il n’est pas suivi de <em>G</em>.</li>
    </ul>
  </li>
  <li>
    <p>On ne sert plus du ligand ou du recepteur.</p>
  </li>
  <li>
    <p>Le complexe était déplacé pour que son premier atome corresponde au premier atome du ligand centré.
  Maintenant, le complexe est simplement centré.</p>
  </li>
  <li>
    <p>Correction dans le calcul de <em>nbAromaPosit</em> (entre autres) : il y avait <em>YWW</em> dans la condition, il y a maintenant <em>YWF</em>.
  La faute apparaissait deux fois : une fois dans <em>CalculerStats</em> et l’autre dans <em>CalculerStats_rim</em>.</p>
  </li>
  <li>
    <p>Lorsqu’il y a des <em>altloc</em> (voir documentation PDB), on ne garde que la première. Un effet collatéral
  de l’implémentation (si plusieurs atomes sont à la suite et ont même nom à l’intérieur d’un même résidu, on ne garde que le premier)
  est que si une ligne est répété immédiatement en dessous, elle est ignoré (ce qui est bien, mais qui cache un défaut du fichier d’entrée).</p>
  </li>
  <li>Les proportions et les distances des paires de type étaient les mêmes pour <em>heart</em> et <em>rim</em>. J’ai modifié pour que <em>heart</em>
  ne prennent que les paires dont aucun des membres n’a accès au solvant.</li>
</ul>

<h2 id="fonction-solvatcomplex">Fonction <em>solvatComplex</em></h2>
<p>Je fais un rapide topo/recap dans l’espoir que les questions qui suivent soient plus claires.</p>
<ul>
  <li>On définit une boîte autour de molécule (avec une marge, donnée par la variable <em>BORDER</em>).</li>
  <li>On éparpille le solvant dans cette boîte : pour ça, on copie plusieurs fois le solvant à intervalles reguliers dans la boîte.</li>
  <li>On définit une intervalle d’interaction entre la molécule et le solvant. Si un atome du solvant est trop proche
  (distance inférieure au seuil minimum) ou trop loin (distance supérieure au seuil maximum), on le vire du résultat.</li>
</ul>

<p>Questions !</p>
<ol>
  <li>Le solvant n’est pas centré avant les appels à la fonction <em>solvatComplex</em>. S’il y a une raison, je la veux bien.
 S’il n’y a pas de raison, est-ce qu’on peut décider de le centrer ?
    <p>En fait le solvant va rester le même pour toutes les simulations. Son point minimum est très proche de <em>(0, 0, 0)</em>, et compte
 tenu de ce qu’on fait avec (multiples copies autour du soluté lors de la dissolution), ça a complètement du sens de le laisser non-centré.</p>
  </li>
  <li>Il y a une multiplication des coordonnées du solvant par le facteur <em>rad</em> dans <em>solvatComplex</em>. Je veux bien une explication
 du pourquoi.
    <p>Sert à tenir compte de la répulsion électrostatique.</p>
  </li>
  <li>Toujours dans <em>solvatComplex</em>, il y a plusieurs quantité fixes :
    <ul>
      <li><em>rad</em> pour la multiplication des coordonnées du solvant,</li>
      <li><em>BORDER</em> pour la taille de la boîte qui entoure la molécule,</li>
      <li><em>BOXSIZE</em> pour le calcul du pas de réplication du solvant,</li>
      <li><em>MAXDIST2</em> pour le seuil maximum d’interaction,</li>
      <li><em>CLASHFACT</em> pour le seuil minimum d’interaction.</li>
    </ul>

    <p class="final">Est-ce que tu veux que je mette certains d’entre eux dans le fichier de config ?</p>
    <p>Pas nécessaire a priori.</p>
  </li>
</ol>

<h2 id="autres">Autres</h2>
<ol>
  <li>La fonction <em>centrerAtomComplex(complexe, moleculeA)</em> permet de déplacer <em>complexe</em> pour que son premier atome coincide avec
 le premier atome de <em>moleculeA</em>. Est-ce que je peux demander pourquoi on fait ça, au lieu de simplement centrer <em>complexe</em>
 (sachant que <em>moleculeA</em> est préalablement centrée).
    <p>On ne se sert plus du ligand et le complexe est simplement centré.</p>
  </li>
  <li>Pour le calcul des centres de gravité. Il y a des calculs par molécules et par résidus. Pour les résidus, on ne prend
 pas en compte les atomes seuls (en tout cas on essaie, voir point d’après), alors qu’on les prend en compte pour la molécule entière.
 S’il y a une raison pour la différence, je la veux bien. Sinon, est-ce qu’on peut homogénéiser ?
    <p>Il y a tout à fait une différence, il faut garder comme ça.</p>
  </li>
  <li>Dans le calcul des centres de gravité des résidus, l’organisation des conditions fait qu’on ne prend pas en compte le atome seuls
 SAUF si c’est le premier atome d’un résidu et que ce n’est pas le premier résidu. En bref, que faire pour les centres de gravité.
    <p>Effectivement une erreur.</p>
  </li>
  <li>Dans la fonction <em>uneLettre</em> de <em>utils.c</em>, le triplet <em>UNK</em> apparait et donne le code <em>X</em> qui n’est jamais utilisé nulle part.
 Est-ce normal ? (Je me rends compte maintenant que <em>UNK</em> peut vouloir dire <em>unknown</em>, donc ce serait effectivement normal).
    <p><em>UNK</em> = <em>unknown</em>.</p>
  </li>
  <li>Dans les fonctions <em>CalculerStat</em> et <em>CalculerStat_rim</em>, dans les conditions de Aroma/Posit, lignes <em>3501</em> et <em>5065</em>,
 je suppose que les <em>3</em> premières lettres doivent être <em>Y</em>, <em>W</em>, <em>F</em>, et non pas <em>Y</em>, <em>W</em>, <em>W</em> comme c’est écrit.
    <p>Oui.</p>
  </li>
  <li>Dans les fonctions <em>CalculerFraction</em> et <em>CalculerFraction_rim</em>, pour les calculs de <em>fractionHydro</em>, lignes <em>2820</em> et <em>4737</em>,
 est-il normal que <em>fractionF</em> soit dans la somme ? Parce que par exemple pour les stats, les lettres qui correspondent à hydro sont
 <em>I</em>, <em>L</em>, <em>M</em>, <em>V</em>, mais pas de <em>F</em>.
    <p>Il faut effectivement garder le <em>F</em>. C’est le problème de la phenylalanine : c’est un résidu hydrophobe mais avec un cycle
 benzénique qui le placerait dans les aromatiques.</p>
  </li>
  <li>Même question pour les calculs de <em>Vhydrophobe</em>, lignes <em>2845</em> et <em>4744</em>, où <em>VF</em> est ajouté.
    <p>Pareil.</p>
  </li>
  <li>Même question pour les calcus de <em>nbhydrophobe</em>, lignes <em>2869</em> et <em>4751</em>, où <em>nbF</em> est ajouté.
    <p>Pareil.</p>
  </li>
  <li>
    <p>Est-ce que je pourrai avoir une explication sur pourquoi les calculs dans <em>DonnerSurfacesResidus</em> et <em>DonnerSurfacesIndividualResidus</em>
 sont différents (les conditions d’ajout sont différentes) ?</p>
  </li>
  <li>
    <p>Aussi, dans le calcul de <em>DonnerSurfacesResidus</em>, il y a un ajout de surface à (abrégé) <em>…aai].asaprot</em> si le vertex correspondant à <em>aaj</em>
n’est pas dans le solvant, mais aucun ajout à <em>…aaj].asaprot</em> si le vertex correspondant à <em>aai</em> n’est pas dans le solvant.
Une des conséquences est que qu’il va manquer des lignes <em>CONTR PER RES</em> dans la sortie (parce que l’écriture se fait en même temps que le calcul).</p>
  </li>
  <li>
    <p>D’ailleurs ! Est-ce que vous vous servez effectivement des lignes <em>CONTR PER RES</em> ?</p>
  </li>
  <li>Dans la fonction <em>EcrireStatNat</em>, la boucle avec <em>numresC</em> ne produit rien, parce que tous les <em>grav-&gt;asa</em> et <em>grav-&gt;asaprot</em> font <em>0</em> ;
et ils font <em>0</em> parce que le calcul des surfaces (qui remplit <em>asa</em> et <em>asaprot</em>) est fait après l’appel à <em>EcrireStatNat</em>.
Je ne sais pas ce que ça devrait faire, mais il faut me dire ce que c’est si vous le voulez ! C’est peut-être juste une histoire d’ordre ?
    <p>Tout ce que j’évoque dans les points <em>9, 10, 11, 12</em> n’est plus utile. Donc je n’ai pas eu de réponse claire.
J’avais commencé à écrire les fonctions en faisant mes propres choix. Je les ai laissées. Si on s’en sert un jour il faudra analyser ce qu’elles font.</p>
  </li>
</ol>

<h1 id="scripts">Scripts</h1>
<h2 id="cha-marche-pach">Cha marche pach</h2>
<h3 id="remarques-générales">Remarques générales.</h3>
<ol>
  <li>
    <p>On se traîne des <em>-1.00</em> tout le long, sans s’en servir apparement.</p>

    <p class="step">Oui, c’est vrai… En fait c’est parce que Hex est capable, quand la structure du complexe est connue,
 de calcul le RMSD entre le complexe et chacune des solutions proposees. Quand la structure du complexe n’est pas connue, ca retourne -1.00.
 C’est d’autant plus inutile que je ne me sers plus de Hex parce que je trouvait que son calcul n’etait pas bon…</p>

    <p class="final">Ok.</p>
  </li>
  <li>
    <p>Un C-score (<em>runFriendsNoElim_cons.pl</em>) est une somme de rang. Les rangs qui composent cette somme sont les rangs des consensus rangés du plus grand au plus petit
 et on ajoutera 1 au C-score si la RMSD avec la molecule de consensus le plus grand est faible. Pareil pour les F-scores (<em>scoreInterface_CONS.pl</em>).
 À l’inverse, lors du calcul de, par exemple, <em>NSCRank</em> (<em>runRanks_CONS.pl</em>), les contributions des consensus sont rangées du plus petit au plus grand.
 On ajoutera 1 au <em>NSCRank</em> du plus faible consensus. Et je trouve ça bizarre !</p>

    <p>J’ai effacé la discussion pour pouvoir repartir. Quel est le NS-rank du consensus le plus petit ? Quel est le NS-score du consensus le plus petit ?
 Doit-on ajouter les NS-rank ou les NS-score pour obtenir les C-score et F-score ?</p>

    <p class="step">Réponse dans l’ordre : <em>1</em>, <em>modelCount - 1</em>, le NS-score.</p>

    <p class="final">Ok.</p>
  </li>
</ol>

<h3 id="rundock_30_30pl"><em>runDock_30_30.pl</em></h3>

<ol start="3">
  <li>
    <p><em>$hexenergy</em> n’a pas l’air utilisé. <em>$hexEtot</em> ne sert qu’à calculer <em>$hexenergy</em>.</p>

    <p class="step">C’est vrai que actuellement je ne m’en sert pas, mais ca pourrait venir…
 J’ai fait quelques essais infructueux, ce qui ne veut pas dire que je n’arriverai a rien avec. Donc, si il peut y avoir par exemple une option pour les calculer et les écrire…</p>

    <p class="final">Pas d’option. Je les écris toujours.</p>
  </li>
  <li>
    <p>Ligne <em>175</em> :</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> system("cp $rundir/list_$prot[$p] Res_$prot[$p]/.");
</code></pre></div>    </div>

    <p>Manque un <em>$rundir/</em> devant le second argument je dirais ! <strong>Conséquences</strong> :
 les deux appels à <em>identify_new_All.pl</em> se plantent, puis ça cascade.</p>

    <p>C’est assez important, vu que comme je disais le script <em>identify_new_All.pl</em> se sert du fichier pour créer un autre fichier, puis d’autres choses se passent j’imagine.
 Bref, ma remarque avait 2 buts : le premier était de dire que cha marche pach, et le second était une demande de confirmation qu’il faut bien ajouter <em>$rundir/</em>
 devant le second argument.</p>

    <p class="step">Ok ! Oui, il manque le <em>$rundir</em>, à se demander comment ça marchait ! Ceci dit, c’est une partie où il y a un méli-mélo de fichiers
 que je copie plusieurs fois et dans des endroits différents. Je nettoie tout à la fin, mais ça ne paraît pas très rationnel !</p>

    <p class="final">Ok.</p>
  </li>
  <li>
    <p>Ligne <em>243</em> : le premier argument du <em>mv</em> n’existe pas : est-ce qu’il s’agit de <em>$rundir/hex_$prot[$p].log</em> ?</p>

    <p class="final">Oui.</p>
  </li>
  <li>
    <p>Ligne <em>104</em> :</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> $hexbump[$hexsol[$nbsol]]=$vals[$nbHvals-2];
</code></pre></div>    </div>

    <p>Le <em>-2</em> fait retomber sur la colonne <em>RMS</em>. La raison est que les lignes lues finissent par des
 espaces, ce qui entraîne que le dernier élément d’un <em>split</em> sera un élément vide.
 J’imagine qu’on devrait lire la colonne <em>Bmp</em> plutôt ? <strong>Conséquences</strong> : on compare
 <em>RMS</em> à <em>$maxclash</em> et les modèles choisis ne sont pas ceux qu’on veut.</p>

    <p class="step">Effectivement c’est bien la colonne <em>Bmp</em> qui m’interesse !
 En fait, certaines fois, et c’est généralement quand il y a un problème dans le calcul de Hex,
 les valeurs d’énergie (les 4 colonnes qui commencent par E), font plus que les 7 caractères “réservés”
 et occupe aussi l’espace qui sépare une colonne de la précédente.  Du coup le split ne marche plus…</p>

    <p class="final">Ok. Je lance une exception si le nombre d’éléments du split ne correspond pas au nombre attendu de colonne (9).
 Il faudra aller voir le log de hex à la main.</p>
  </li>
  <li>
    <p>Ligne <em>348</em> : il manque l’indice dans <em>$fnat&gt;0.3</em>.</p>

    <p class="step">Ah ben bravo ! On se demande comment ca pouvait marcher !</p>

    <p class="final">Ok.</p>
  </li>
</ol>

<p class="step">La suite apparait après correction des erreurs de <em>runDock_30_30.pl:176</em> et <em>runDock_30_30.pl:104</em>.</p>

<ol start="8">
  <li>
    <p>Ligne <em>145</em> : ça m’ennuie d’avoir un nouveau numéro différent de l’ancien. <strong>J’ai changé ça.</strong>
 Avec l’erreur les anciens et nouveaux étaient tout le temps égaux.</p>

    <p class="step">Tu veux dire que tu gardes l’ancien numero ? En fait c’etait parce que certains scripts ne marchaient que si on avait des numeros consecutifs.
 Et aussi, le numero donnait le classement Hex. Si on a pas des numeros consecutifs il faudra recalculer les classements Hex.</p>

    <p class="final">Ok.</p>
  </li>
  <li>
    <p>Même problème aux lignes <em>256-259</em>. <strong>J’ai aussi changé ça.</strong></p>

    <p class="step">Oui, si on a plus des numeros consecutifs il faut changer</p>

    <p class="final">Ok.</p>
  </li>
  <li>
    <p>Ligne <em>258</em> : <em>OUTFILE</em> a été fermé à la ligne <em>241</em> mais pas ré-ouvert. Il ne se passe donc rien.</p>

    <p class="step">C’est vraiment le bazar ces scripts ! Je ne sais pas qui les a ecrits mais je ne la felicite pas !</p>

    <p class="final">J’en déduis que ce n’est pas important et je ne fais rien.</p>
  </li>
</ol>

<h3 id="runirmsd_conspl"><em>runIRMSD_CONS.pl</em></h3>

<ol start="11">
  <li>
    <p>Lignes <em>19, 23, 26, 27, 31</em> : le dossier <em>$confRep=”$prot[$p]/CONFS/”</em> n’existe pas. J’imagine que ça devrait être <em>$rundir/$prot[$p]/CONFS/</em>.
<strong>Conséquences :</strong> le script <em>makeList.pl</em> n’est pas appelé, ce qui ne créé pas de <em>list.txt</em>, et le <em>list.txt</em> utilisé par le programme <em>rmsd_list</em> est sans
doute celui d’un run passé. En tout cas pas de celui du moment.</p>

    <p class="step">Probablement je genere le fichier avant dans le script principal. Du coup ca marche quand meme… Mais bon, c’est pas tres propre !</p>

    <p class="final">Ok.</p>
  </li>
  <li>
    <p>Ligne <em>30</em> : cette variable <em>$modList</em> n’est pas utilisé. Heureusement ! Elle pointe sur un fichier qui n’existe pas à cause du mauvais <em>$confRep</em>.</p>

    <p class="final">Ok.</p>
  </li>
</ol>

<h3 id="missingvalue2medormoy-globaltargetpl"><em>missingValue2MedOrMoy-globalTarget.pl</em></h3>
<p>Cette normalisation me paraît suspecte.</p>

<ol start="13">
  <li>
    <p>On calcule les <em>min, max</em> à partir des modèles calculés, mais on lis simplement les <em>med, moy</em> des références et on ne fait rien des <em>min, max</em> des références.
C’est bizarre !</p>

    <p class="step">C’est parce qu’il y a deux choses differentes: les min et max des modeles servent a la normalisation et les med ou moy pour les valeurs manquantes</p>
  </li>
  <li>
    <p>Comment peut-on avoir des valeurs manquantes ?</p>
  </li>
  <li>
    <p>Pour les valeurs manquantes, je note qu’il n’y a pas de précautions prises pour les divisions par <em>0</em>.</p>
  </li>
  <li>Les <em>0</em> et manquants ne sont pas tous traitées de la même manière. Ils deviennent
    <ul>
      <li>\(\frac{reference-min}{max-min}\) si <em>min</em> et <em>max</em> sont différents,</li>
      <li><em>0</em> si <em>min</em> et <em>max</em> sont égaux à <em>0</em> (ils ne peuvent pas être égaux à autre chose, puisque la valeur fait <em>0</em>), auquel cas on a shunté la référence complètement.</li>
    </ul>
  </li>
  <li>Les valeurs non nulles ne sont pas toutes traitées de la même manière (enfin, ça s’argumente). Ils deviennent
    <ul>
      <li>\(\frac{valeur-min}{max-min}\) si <em>min</em> et <em>max</em> sont différents,</li>
      <li><em>valeur</em> si <em>min</em> et <em>max</em> sont égaux (forcément non nuls, puisque la valeur ne l’est pas). Pourquoi pas <em>1</em> par continuinité avec le premier cas ?</li>
    </ul>
  </li>
  <li>
    <p>Qu’est-ce qu’on <strong>veut</strong> ?</p>

    <p class="step">Dans ce script il y a deux choses, (1) le remplacement des donnees manquantes et (2) la normalisation.
Pour les valeurs manquantes : si on prend par exemple les paires hydrophobes-polaires, dans un modele donne il n’y en a pas forcement.
Pour le nombre de paires on met donc zero, mais pour la distance, si on met 0 ca voudrait dire que cette distance existe et qu’elle est de zero.</p>

    <p style="color:black">J’ai effacé la discussion pour qu’on puisse repartir. Le tableau ci-dessous donne les valeurs après complétion/normalisation. Est-ce ce qu’on veut ?</p>

    <p>Les <em>min</em> et <em>max</em> sont calculés sur toutes les valeurs non-manquantes.</p>

    <table>
      <thead>
        <tr>
          <th style="text-align: center"> </th>
          <th style="text-align: center">manquant</th>
          <th style="text-align: center">\(x=0\)</th>
          <th style="text-align: center">\(x\ne 0\)</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td style="text-align: center">\(min\ne max\)</td>
          <td style="text-align: center">\(\displaystyle{\left(\frac{med - min}{max - min}\right)}\)</td>
          <td style="text-align: center">\(0 = \displaystyle{\left(\frac{x - min}{max - min}\right)}\)</td>
          <td style="text-align: center">\(\displaystyle{\left(\frac{x - min}{max - min}\right)}\)</td>
        </tr>
        <tr>
          <td style="text-align: center">\(min = max\ne 0\)</td>
          <td style="text-align: center">\(0.5\)</td>
          <td style="text-align: center">impossible</td>
          <td style="text-align: center">\(0.5\)</td>
        </tr>
        <tr>
          <td style="text-align: center">\(min = max = 0\)</td>
          <td style="text-align: center">\(0\)</td>
          <td style="text-align: center">0</td>
          <td style="text-align: center">impossible</td>
        </tr>
      </tbody>
    </table>

    <p class="final">Nouveau plan : <em>min</em> et <em>max</em> sont calculés après introduction des valeurs de références :</p>

    <ul class="final">
      <li>je remplace les valeurs manquantes par les valeurs de références,</li>
      <li>je calcule les <em>min</em> et <em>max</em>,</li>
      <li>je normalise avec
        <ul>
          <li>
            <p>\(\displaystyle{\left(\frac{x - min}{max - min}\right)}\) si \(min\ne max\),</p>
          </li>
          <li>
            <p>\(0.5\) si \(min=max\ne 0\),</p>
          </li>
          <li>
            <p>\(0\) si \(min=max=0\).</p>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ol>

<h3 id="predict-nlpl"><em>predict-NL.pl</em></h3>

<ol start="19">
  <li>
    <p>Que signifie les lettres <em>w</em> et <em>c</em> ?</p>

    <p class="step">Ce sont les grandeurs optimisees dans l’algo genetique. On optimise une fonction de la forme
$f=\sum_i w_i |x_i - c_i|$ donc $w_i$ est un poids et $c_i$ une valeur de centrage pour chacun des 96 parametres.</p>

    <p class="final">Ok.</p>
  </li>
</ol>

<h3 id="boltzmanpl"><em>boltzman.pl</em></h3>

<ol start="20">
  <li>
    <p>Je ne vois pas comment on peut rentrer dans les <em>if</em>, vu qu’on écrit nous même les fichiers sous le format des <em>elsif</em>.</p>

    <p class="final">Un reste d’un code passé. Ignorons le.</p>
  </li>
  <li>
    <p><em>$rmsd_first</em> et <em>$rmsd_comp</em> sont mis à <em>0</em> juste avant d’être écrit.</p>

    <p class="step">Seulement dans l’une des deux conditions. Mais la c’est Thomas qui a ecrit ce script, et nous n’avons pas du tout la meme facon d’utiliser perl !
Ceci dit, le script marche bien, donc il doit y avoir une logique… Quoi que…</p>

    <p class="final">J’ignore les deux variables.</p>
  </li>
</ol>

<h3 id="compare_sumpl"><em>compare_sum.pl</em></h3>

<ol start="22">
  <li>
    <p>Variable <em>$delta</em> non utilisée.</p>

    <p class="step">Effectivement on dirait bien…</p>

    <p>Juste pour être clair, il y a une question sous-jacente à ce genre de remarque qui est :
est-ce qu’il y a une faute qui doit être corrigée, et si oui comment. Dans ce cas par exemple, est-ce que la variable <em>$delta</em> devrait faire quelque chose ?</p>

    <p class="final">J’ignore la variable.</p>
  </li>
  <li>
    <p>Je ne vois comment le jeu avec la variable <em>$boolean_deja_vu</em> pourrait être utile. La seule manière d’entrer dans le
<em>if($boolean_deja_vu == 0)</em> est d’avoir un numéro de modèle non spécifique qui n’est pas un numéro de modèle spécifique.
Comment est-ce possible !</p>

    <p class="step">Effectivement je ne vois pas trop comment ce serait possible…</p>

    <p class="final">J’ignore la variable.</p>
  </li>
</ol>

<h3 id="rmsd_listc"><em>rmsd_list.c</em></h3>

<ol start="24">
  <li>
    <p>Est-ce qu’il faut le faire marcher pour toutes les options ? Ou juste celles qui sont appelées par <em>runDock</em> ?
<strong>J’ai juste mis celles de <em>runDock</em> pour l’instant.</strong></p>

    <p class="step">Oui, je pense que ca suffira… Ce qui est important a garder :
    - la possibilite de calculer tous les rmsd croises dans la liste, ou seulement le premier de la liste avec tous les autres,
    - la possibilite de limiter le calcul a une seule chaine,
    - la possiblite de limiter au backbone (voir en dessous) et
    - la possibilite de limiter a une liste d’acides amines. Mais je ne suis pas sure en fait qu’il y ai d’autres options…</p>

    <p class="final">Ma question était ratée : 2 options sont utilisées dans <em>runDock</em>, 2 dans <em>runIRMSD_CONS</em>, donc il faut toutes les faire de toute façon.</p>
  </li>
  <li>
    <p>Seulement chaîne <em>2</em> ? C’est normal ? C’est parce que c’est la dernière ?</p>

    <p class="step">C’est parce que les modeles, par construction ont la meme chaine 1, et ce qui nous interesse du coup c’est le rmsd entre les chaines 2,
soit seulement sur la liste fournie, soit sur l’ensemble de la chaine, eventuellement reduite au atomes du squelette (N, CA, C, O)</p>

    <p class="final">Ok.</p>
  </li>
  <li>
    <p>Il y a une erreur dans l’utilisation des atomes de fin de chaînes : <em>endChain</em> pointe sur le dernier atome,
mais les boucles ne l’incluent pas. <strong>Conséquences : il manque un calcul de distance entre les derniers atomes.
J’ai changé ça.</strong></p>

    <p class="step">Ok</p>
  </li>
</ol>

<h3 id="cmapc"><em>cmap.c</em></h3>

<ol start="27">
  <li>
    <p>Il y a une double boucle sur les chaînes, mais le fichier de sortie est réouvert (en ‘w’, pas en ‘a’) à chaque paire de chaînes.
<strong>Conséquences : seule la dernière paire a effectivement un impact sur la sortie.</strong> Ça n’a pas d’effet si toutes les
protéines ont <em>2</em> chaînes ou moins, ce qui a l’air d’être le cas sur l’exemple que j’ai.
<strong>Le C++ fait une somme sur toutes les paires de chaînes (mais ne peut pas vraiment tester que ça marche pour plus de <em>2</em>).</strong>
Est-ce que toutes les molécules doivent avoir exactement deux chaînes ? Si non, que faire quand il y a en plus de deux ?</p>

    <p class="step">Normalement il fait un fichier par paire de chaines. Donc si il y a seulement deux chaines, il y a un seul fichier.
Si il y a trois chaines ca fait 3 fichiers (AB, AC et BC) et ainsi de suite… Je pensais que ca marchait !</p>

    <p class="final">Le C++ ne supporte maintenant plus qu’une seule paire de chaîne.</p>
  </li>
</ol>

<h3 id="runfriendsnoelim_conspl"><em>runFriendsNoElim_cons.pl</em></h3>

<ol start="28">
  <li>
    <p>Les molécules sont centrées pour calculer les dissolutions, les stats, puis certains scores, en particulier les consensus.
D’un autre côté, les RMSDs sont calculées à partir des molécules non-centrées, directement lues de la sortie de <em>hex</em>.
C’est pourquoi il me semble bien étrange de calculer les C-scores à partir des consensus <strong>et</strong> des RMSDs.
Confirmation que c’est normal ?</p>

    <p class="step">Oui, c’est normal. C’est parce que Hex va sortir tous les modeles avec les chaines 1 (recepteur) superposees,
du coup on peut comparer les chaines 2 directement sans bouger les modeles</p>

    <p class="final">Ok.</p>
  </li>
  <li>
    <p>Le programme regarde la RMSD entre la molécule et elle-même, soit <em>0</em>, ajoute donc le rang
de la molécule à son C-score.</p>

    <p class="step">Pas terrible en effet… Et pas tres utile en plus !</p>

    <p class="final">J’ai corrigé.</p>
  </li>
</ol>

<h3 id="scoreinterface_conspl"><em>scoreInterface_CONS.pl</em></h3>

<ol start="30">
  <li>
    <p>Des parenthèses foireuses ligne <em>30</em>: <em>if(length($vals[1]==5))</em> au lieu de <em>if(length($vals[1])==5)</em>.
Voir ma remarque générale en haut de la section.</p>

    <p class="final">La condition était sensé influer sur les <em>-1</em> à la fin des noms des fichiers. Tout cela ne sert à rien.</p>
  </li>
  <li>
    <p>Je suspecte qu’il y a eu plantage dans les indices de <em>$score1, $score2</em> aux lignes <em>157</em> et <em>160</em>.
<strong>Conséquence : les F-scores (ceux de ‘freqScore’)sont tous faux.</strong> Ceux de ‘freqAA’ sont ok.
<strong>Ce que fais le C++, et qui j’imagine est l’intention, mais qui nécessite confirmation :</strong>
on prend l’indice <em>$index</em> tel que <em>$listEpi[$index] == $epi[$p][$i]</em>.</p>

    <p class="step">Oui, je pense que c’est bien ca… Je ne vois pas comment j’ai pu laisser passer une connerie pareille et ne pas m’en apercevoir.
Parce que pour le coup ca va changer les resultats ! Pour qu’on soit bien d’accord, je t’explique ce que c’est sense faire.
On donne une liste de prot ordonnees (la premiere est la meilleure, la derniere la moins bien).
Pour chaque prot, on regarde quel sont les acides amines qui participent a l’interaction dans chacune des deux chaines.
Pour chaque acide amine si il est present dans un modele (sans repetition, chaque acide amine n’est compte qu’une fois par modele,
meme si il est present plusieurs fois dans le fichier map), on ajoute le score de ce modele au score de l’acide amine.
Le freqScore d’un modele, sense etre calcule a la fin, est la somme des scores des acides amines qui sont a l’interface dans ce modele.</p>

    <p class="final">Ok. Vérifie les résultats quand même !</p>
  </li>
  <li>
    <p>La même question que <em>cmap.c</em> se pose : que faire s’il y a plus de deux chaînes ?
<strong>Le C++ fait un calcul par paire de chaînes.</strong></p>

    <p class="step">Ce programme la n’est utilise que dans le cas ou il n’y a que deux chaines.</p>

    <p class="final">Ok.</p>
  </li>
</ol>

<h3 id="runirmsd_conspl-1"><em>runIRMSD_CONS.pl</em></h3>

<ol start="33">
  <li>
    <p>La même question que <em>cmap.c</em> se pose : que faire s’il y a plus de deux chaînes ?
<strong>Le C++ construit la liste des résidus en prenant l’union sur toutes les
paires de chaînes dont la second chaîne est la dernière (voir mes remarques sur <em>cmap.c</em>)
de la molécule.</strong></p>

    <p class="step">Ce programme la n’est utilise que dans le cas ou il n’y a que deux chaines.</p>

    <p class="final">Ok.</p>
  </li>
</ol>

<h3 id="runranks_conspl"><em>runRanks_CONS.pl</em></h3>

<ol start="34">
  <li>
    <p>Ligne <em>67</em> : tu utilises le rang global de hex (<em>$hexRank[$m]=$protName[$m];</em>) au lieu d’utiliser le rang
parmi les modèles <strong>qui restent</strong> après élimination de ceux qui clashent.
Pour toi c’est la même chose parce que tu as renommé les modèles (voir ma remarque à la section <em>runDock_30_30.pl</em>, juste après le rouge),
mais maintenant que j’ai évité ce renommage, il faut calculer <em>$hexRank</em> de la même manière que <em>$CRank, $FRank</em>. Cool ? Cool.</p>

    <p class="step">Oui, comme je l’ai dit au-dessus, si on ne renomme pas, il faut calculer un hex-score…</p>

    <p class="final">Cool.</p>
  </li>
</ol>

<h1 id="autre">Autre</h1>

<ol start="35">
  <li>
    <p><em>Hex</em> ne donne pas les mêmes résultats pour deux exécutions consécutives. Booooooooooooooo.</p>

    <p class="step">C’est normal, il y a une heuristique dedans… Si tu veux que ca donne toujours la meme chose, il faut commenter derniere ligne (wobble) dans le fichier <em>set_parameters_global_30_30.mac</em> il me semble</p>

    <p class="final">Enlever <em>wobble</em> ne suffit pas à enlever le random.</p>
  </li>
  <li>
    <p>Je trouve cette ligne dans les log de ‘hex’ :</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~*Error* Macro command not recognised: docking_refine
</code></pre></div>    </div>

    <p><em>docking_refine 1</em> est ajoutée par <em>make_mac_classic_30_30.pl</em>.
J’imagine que ça marchait dans une version antérieure de ‘hex’. Je te
laisse investiguer s’il faut changer cette ligne en autre chose pour
re-avoir le comportement que <em>docking_refine 1</em> donnait.</p>

    <p class="step">Oui, probablement, tu peux juste commenter pour le moment</p>

    <p class="final">Ok.</p>
  </li>
  <li>
    <p>À propos des fichiers <em>.mac</em>. Je note <em>30_30</em> dans le nom des fichiers,
mais il y a 3 ‘30’ dans <em>set_parameters_global_30_30.mac</em>, ce qui
m’empêche de déterminer à quoi correspond les (seulement) deux ‘30’ des
noms de fichier. Est-ce que tu veux que ces ‘30’ passent dans le
fichier config ?</p>

    <p class="step">En fait ils devraient… Mais je n’ai jamais eu le courage de le faire ! Ca correspond aux valeurs des parametres
<em>receptor_range_angle</em> et <em>ligand_range_angle</em> dans le fichier <em>set_parameters_global_30_30.mac</em>.
Donc quand je veux les changer, je le fais dans ce fichier la. Et comme a un certain moment je testais differentes valeurs, j’avais renommer les fichier. Bref, pas tres pro !</p>

    <p>Est-ce que tu peux me confirmer que je peux déplacer ces deux options depuis <em>set_parameter_global.mac</em> vers <em>dock_uu_global.mac</em>
(fichier dans lequel on trouve <em>run_macro set_parameter_global.mac</em>) ? J’ai du mal à vérifier avec l’histoire random de hex.</p>

    <p class="step">En fait il faudrait que dans le fichier de config du nouveau programme on définisse
toutes les valeurs qui sont déclarées dans set_parameter_global.mac, et que le programme écrive ce fichier
à chaque exécution. Comme ça on peut modifier les paramètres de Hex pour chaque exécution du programme.
Comme valeurs par défaut tu peux prendre celles qui sont dans le fichier set_parameter_global.mac actuel.</p>

    <p>Ok, je fais ça. Mais ça ne répond pas à ma question : est-ce qu’il est équivalent d’avoir</p>
    <ul>
      <li>
        <p>un fichier <em>un.mac</em> qui contient :</p>

        <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  ligand_range_angle = 30
  run_macro deux.mac
</code></pre></div>        </div>

        <p>et un second fichier <em>deux.mac</em> qui contient :</p>

        <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  receptor_range_angle = 30
</code></pre></div>        </div>
      </li>
      <li>
        <p>ou un unique fichier <em>undeux.mac</em> qui contient :</p>

        <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  ligand_range_angle = 30
  receptor_range_angle = 30
</code></pre></div>        </div>
      </li>
    </ul>

    <p class="final">Elle pense que c’est équivalent.</p>
  </li>
  <li>
    <p>Les fichiers de références ont des <em>med</em> et <em>max</em> dans leurs noms alors qu’ils contiennent de toute façon <em>min, max, mean, median</em>. Aussi,
<em>Heart_learning_3NGB</em> a <strong>trois</strong> variantes : <em>.max.vals, .med.vals, .vals</em>, toutes égales. J’ai viré toutes les extensions.</p>

    <p class="step">Euh… Effectivement ! par contre les fichiers .max .med et sans extension sont differents</p>

    <p class="final">J’ai été un peu brutal.</p>
  </li>
</ol>

<h1 id="format-des-fichiers-dentréessorties">Format des fichiers d’entrées/sorties</h1>

<ol start="39">
  <li>
    <p>Les <em>96</em> paramètres :/ On passe à libconfig ?</p>

    <p class="step">Euh… Ca veut dire quoi ?</p>
  </li>
  <li>
    <p>Les fichiers références (ceux qui contiennent <em>min, max, mean, median</em>). Comment sont-ils générés ?
Au <strong>minimum</strong>, faire <em>4</em> lignes, chacune contenant <em>96</em> paramètres, afin d’être cohérent avec les autres. Mais sinon, on passe à libconfig ?</p>
  </li>
  <li>
    <p>Les fichiers <em>cmaes.1</em> pour <em>predict_NL.pl</em>. Comment sont-il générés ?
Au <strong>minimum</strong>, faire <em>2</em> lignes, chacune contenant <em>96</em> paramètres, afin d’être cohérent avec les autres. Mais sinon, on passe à libconfig ?</p>

    <p class="step">Les fichiers cmaes.1 dans chaque run sont les résultats de l’apprentissage. Le probleme si on change le format,
c’est qu’il faudra aussi qu’on change les scripts qui generent ces fichiers la… Donc si on peut continuer comme ca c’est plutot mieux !
C’est un peu pareil pour le point au dessus, les fichier min, max etc sont generes a partir des structures de reference,
et je dois dire que ca m’ennuie un peu de remettre les doigts la-dedans. D’autant que c’est Thomas qui a ecrit les scripts, et j’ai souvent beaucoup de mal a comprendre ce qu’il a fait !</p>
  </li>
</ol>


		</div>
	</body>
</html>
